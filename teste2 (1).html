<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Ideb</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    .container {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      max-width: 900px;
      margin: 20px auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .title {
      font-weight: bold;
      font-size: 24px;
      text-align: center;
    }
    .dropdowns {
      margin: 10px 0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    select {
      padding: 8px;
      border-radius: 10px;
      border: 3px solid #f1f1f1;
    }
    .cards {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 30px;
    }
    .card {
      background: #f1f1f1;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
      width: 120px;
      transition: transform 0.3s ease;
    }
    .card .titulo {
      font-size: 16px;
      font-weight: bold;
      color: #f07706;
      margin-bottom: 5px;
    }
    .card .valor {
      color: red;
      font-size: 28px;
      font-weight: bold;
    }
    .card .info, .card .meta {
      font-size: 12px;
      color: #555;
      margin-top: 8px;
    }
    .bandeira-titulo-flex {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .bandeira-titulo-flex img {
      width: 60px;
      height: auto;
    }
    .bandeira-titulo-flex h2 {
      font-size: 20px;
      margin: 0;
    }

    .analise {
      margin-top: 20px;
      background: #eaf7ed;
      padding: 20px;
      border-left: 6px solid #28a745;
      border-radius: 8px;
    }

    .analise h3 {
      margin-top: 0;
      color: #1d643b;
    }

    .analise p {
      margin-bottom: 10px;
      line-height: 1.6;
    }
  </style>
</head>
<body>

  <div class="container bandeira-titulo">
    <div class="bandeira-titulo-flex">
      <img src="/images/Bandeira_do_Maranh√£o.svg" alt="Bandeira MA">
      <h2>Estado do Maranh√£o</h2>
    </div>
  </div>

  <div class="container">
    <div class="title">Ideb</div>
    <p>
      O par√¢metro √© calculado com base no aprendizado dos alunos em portugu√™s e matem√°tica (Saeb) e no fluxo escolar (taxa de aprova√ß√£o). Veja o Ideb do pa√≠s e a situa√ß√£o das escolas.
    </p>

    <div class="dropdowns">
      <select id="ano">
        <script>
            for (let ano = 2007; ano <= 2023; ano += 2) {
              const selected = ano === 2019 ? 'selected' : '';
              document.write(`<option value="${ano}" ${selected}>${ano}</option>`);
            }
        </script>
      </select>

      <select id="etapa">
        <option value="AI">Anos Iniciais</option>
        <option value="AF">Anos Finais</option>
        <option value="EM">Ensino M√©dio</option>
      </select>

      <select id="tipo">
        <option value="5">P√∫blica</option>
        <option value="2">Estadual</option>
        <option value="3">Municipal</option>
        <option value="1">Federal</option>
        <option value="4">Privada</option>
        <option value="0" selected>Total</option>
      </select>

      <button onclick="buscarDados()">Buscar</button>
    </div>

    <div class="cards">
      <div class="card">
        <div class="titulo">Aprendizado</div>
        <div class="valor" id="valor-aprendizado">--</div>
        <div class="info">Notas mais altas,<br>maior aprendizado.</div>
      </div>

      <div class="card">
        <div class="titulo">Fluxo</div>
        <div class="valor" id="valor-fluxo">--</div>
        <div class="info">Maior valor,<br>maior aprova√ß√£o.</div>
      </div>

      <div class="card">
        <div class="titulo">Ideb</div>
        <div class="valor" id="valor-ideb">--</div>
        <div class="meta" id="meta-ideb">Meta --</div>
      </div>
    </div>
  </div>

  <div class="container">
    <canvas id="graficoIdeb" style="margin-top: 20px; width: 100%; max-height: 400px;"></canvas>

    <div class="analise">
      <h3>üìä An√°lise da Evolu√ß√£o do Ideb no Maranh√£o (2007‚Äì2019)</h3>
      <p>O gr√°fico apresentado mostra a evolu√ß√£o do √çndice de Desenvolvimento da Educa√ß√£o B√°sica (Ideb) no estado do Maranh√£o, no per√≠odo de 2007 a 2019, com destaque para a linha de metas projetadas.</p>
      <p><strong>‚úÖ Crescimento cont√≠nuo:</strong> O Ideb subiu de aproximadamente 3,5 para 4,7 nesse intervalo, refletindo avan√ßos s√≥lidos na educa√ß√£o b√°sica.</p>
      <p><strong>üöÄ Superando metas:</strong> Desde 2015, o Maranh√£o passou a atingir e at√© superar as metas previstas, resultado de pol√≠ticas p√∫blicas eficazes.</p>
      <p><strong>üß† Consolida√ß√£o:</strong> Os resultados sugerem uma consolida√ß√£o dos avan√ßos, demonstrando estabilidade no crescimento e investimentos sustent√°veis.</p>
      <p>Apesar dos desafios, o estado tem mostrado um caminho promissor rumo √† melhoria da qualidade do ensino, sendo um exemplo de progresso na educa√ß√£o p√∫blica.</p>
    </div>
  </div>

  <script>
    const TOKEN = 'fVzQoVqWguKUyg6e88XqeJmex1LwRWJtRFTJiXSX';

    async function buscarDados() {
      const municipio_id = 21; // Maranh√£o
      const ano = document.getElementById('ano').value;
      const etapa = document.getElementById('etapa').value;
      const ciclo_id = etapa;

      const url = `https://api.qedu.org.br/v1/ideb?id=${municipio_id}&ano=${ano}&ciclo_id=${ciclo_id}`;

      try {
        const response = await fetch(url, {
          headers: {
            'Authorization': `Bearer ${TOKEN}`,
            'Accept': 'application/json'
          }
        });

        if (!response.ok) throw new Error(`Erro na requisi√ß√£o: ${response.status}`);
        const resultado = await response.json();
        const item = resultado.data?.[0];

        const formatar = (valor, isPercent = false) => {
          if (valor === null || valor === undefined || isNaN(valor)) return '';
          const num = parseFloat(valor);
          return isPercent ? (num * 100).toFixed(1) + '%' : num.toFixed(2);
        };

        document.getElementById('valor-aprendizado').innerText = formatar(item?.aprendizado);
        document.getElementById('valor-fluxo').innerText = formatar(item?.fluxo, true);
        document.getElementById('valor-ideb').innerText = formatar(item?.ideb);
        document.getElementById('meta-ideb').innerText = 'Meta ' + formatar(item?.ideb_projetado);
      } catch (error) {
        console.error('Erro ao buscar dados:', error);
        document.querySelectorAll('#valor-aprendizado, #valor-fluxo, #valor-ideb, #meta-ideb')
                .forEach(el => el.innerText = 'N√£o encontrado');
      }
    }

    async function carregarGrafico() {
      const municipio_id = 21;
      const etapa = document.getElementById('etapa').value;
      const ciclo_id = etapa;

      const anos = [];
      const idebReal = [];
      const idebMeta = [];

      for (let ano = 2007; ano <= 2023; ano += 2) {
        const url = `https://api.qedu.org.br/v1/ideb?id=${municipio_id}&ano=${ano}&ciclo_id=${ciclo_id}`;
        try {
          const response = await fetch(url, {
            headers: {
              'Authorization': `Bearer ${TOKEN}`,
              'Accept': 'application/json'
            }
          });

          const resultado = await response.json();
          const total = resultado.data.find(item => item.dependencia_id === 0);
          if (total) {
            anos.push(ano);
            idebReal.push(parseFloat(total.ideb));
            idebMeta.push(parseFloat(total.ideb_projetado));
          }
        } catch (error) {
          console.warn(`Erro ao buscar dados do ano ${ano}:`, error);
        }
      }

      const ctx = document.getElementById('graficoIdeb').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: anos,
          datasets: [
            {
              label: 'Maranh√£o',
              data: idebReal,
              backgroundColor: 'rgba(30,144,255,0.7)',
              borderColor: 'dodgerblue',
              borderWidth: 1
            },
            {
              label: 'Projetado',
              data: idebMeta,
              type: 'line',
              borderColor: 'green',
              backgroundColor: 'green',
              borderWidth: 2,
              tension: 0.3,
              fill: false,
              pointStyle: 'circle',
              pointBackgroundColor: 'white',
              pointBorderColor: 'green'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Evolu√ß√£o do Ideb (Total)'
            },
            tooltip: {
              mode: 'index',
              intersect: false
            },
            legend: {
              position: 'bottom'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 10
            }
          }
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      buscarDados();
      carregarGrafico();
    });
  </script>
</body>
</html>
